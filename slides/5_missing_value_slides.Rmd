---
title: "Handle Missing Values"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      
   

---
class: inverse

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(message = FALSE)
```

```{r xaringan-tile-view, echo=FALSE}
xaringanExtra::use_tile_view()
```


```{r xaringan-panelset, echo=FALSE}
xaringanExtra::use_panelset()
```

```{r, echo=FALSE}
xaringanExtra::use_webcam()
```

```{r xaringan-fit-screen, echo=FALSE}
xaringanExtra::use_fit_screen()
```

# New Functions

- colSums(is.na()), colMeans(is.na())

- na_if

- drop_na

- replace_na

- fill

- is.infinite


---
class: inverse, center, middle
# 1. Do you need to handle missing values?

---
class: inverse, center, middle
# No if just doing some calculations on the data

---
class: inverse

```{r}
library(tidyverse)
df <- read_csv('https://bryantstats.github.io/math421/data/titanic_missing.csv')
df %>% summarise(mean_age=mean(Age, na.rm=TRUE))
```

---
class: inverse, center, middle
# No if just doing Visualization

---
class: inverse
```{r}
df %>% ggplot(aes(x=Age, color=Sex))+
    geom_density()
```

---
class: inverse
When do you need to handle missing values

- When you know the values of the missing values


- When building predictive models

- Other cases?

---
class: inverse
# Checking 

---
class: inverse

```{r}
# Missing values by columns
colSums(is.na(df))
```
---
class: inverse

```{r}
# Missing values by columns
colMeans(is.na(df))
```

---
class: inverse

# Visualizing it

```{r}
library(visdat)
vis_miss(df)
```

---
class: inverse

# Visualizing it

```{r}
library(visdat)
vis_dat(df)
```

---
class: inverse
# Steps to Handle missing values

- Step 1: Identify Missing Values (NA, 'Unknown', 'Missing','9999'...) and Convert them to `NA`

- Step 2:  Either 

  - Remove them
  - Replace them 
  
     - Numeric Variables: 
          - (1) by the mean/ median 
          - (2) predicted values by some models
          
     - Categorical Variables: 
          - (1) the mode or make it a new category
          - (2) predicted values by some models    

---
class: inverse
# Step 1: Identify Missing Values and Convert them to `NA`

- Sometime the missing values are not in `NA`

```{r}
colSums(df=='Missing', na.rm = TRUE)
```

---
class: inverse
# Step 1: Identify Missing Values and Convert them to `NA`

- Sometime the missing values are not in `NA`

```{r}
vis_expect(df, ~.x == 'Missing')
```


---
class: inverse
```{r}
sum(d=='Unknown', na.rm = TRUE)
```

---
class: inverse
```{r}
sum(d=='Not Reported', na.rm = TRUE)
```

---
class: inverse
```{r}
sum(d=='Not Rep', na.rm = TRUE)
```

---
class: inverse
# Convert values to NA 

```{r}
d$TRAV_SP <- na_if(d$TRAV_SP, 'Unknown')
sum(d$TRAV_SP=='Unknown', na.rm = TRUE)
``` 

---
class: inverse
# 5. Remove rows with missing values with drop_na

- Remove rows without `hospitalized` data

```{r}
drop_na(df, hospitalized)
```

---
class: inverse
```{r}
drop_na(df, hospitalized, death)

# Pipe
df %>% drop_na(hospitalized, death)
```

---
class: inverse
# Remove columns with missing values

```{r}
df$negativeTestsPeopleAntibody <- NULL
```

---
class: inverse
# 6. Replace Missing values with replace_na

```{r}
# Replace by the mode for categorical variable
average_death <- mean(df$deathConfirmed, na.rm = TRUE)
df$deathConfirmed <- replace_na(df$deathConfirmed, average_death)
```

